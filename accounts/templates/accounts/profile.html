{% extends 'accounts/base.html' %}
{% load static %}

{% block content %}
<div class="row">
    <div class="col-md-3">
        <ul class="list-group">
            <li class="list-group-item active">Меню</li>
            <li class="list-group-item"><a href="#">История</a></li>
            <li class="list-group-item"><a href="#">Настройки</a></li>
            <li class="list-group-item"><a href="#">Помощь</a></li>
        </ul>
    </div>
    <div class="col-md-9">
        <h1>Добро пожаловать, {{ user.email }}!</h1>
        <p>Ваш баланс: {{ user.profile.balance }}</p>

        <!-- Выпадающие списки для регионов -->
        <div>
            <label for="google-regions">Выбор региона (Google):</label>
            <select id="google-regions"></select>
        </div>

        <div>
            <label for="yandex-regions">Выбор региона (Yandex):</label>
            <select id="yandex-regions"></select>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Загружаем данные из CSV для Google
    fetch("{% static 'dropdowns/geotargets-google.csv' %}")
        .then(response => response.text())
        .then(data => {
            const googleSelect = document.getElementById("google-regions");
            data.split('\n').slice(1).forEach(row => {
                const [criteriaId, , canonicalName] = row.split(',').map(cell => cell.replace(/"/g, ''));
                if (criteriaId && canonicalName) {
                    const option = document.createElement("option");
                    option.value = criteriaId;
                    option.text = canonicalName;
                    googleSelect.add(option);
                }
            });
            $(googleSelect).select2(); // Инициализация Select2 для Google
        });

    // Загружаем данные из JSON для Yandex
    fetch("{% static 'dropdowns/yandex-ru-geo-codes.json' %}")
        .then(response => response.json())
        .then(data => {
            const yandexSelect = document.getElementById("yandex-regions");
            data.forEach(item => {
                const option = document.createElement("option");
                option.value = item.lr;
                option.text = item.location;
                yandexSelect.add(option);
            });
            $(yandexSelect).select2(); // Инициализация Select2 для Yandex
        });
});
</script>
{% endblock %}
